# 日本法令XML→Markdown変換ツール

日本の法令XMLデータを読みやすいMarkdown形式に変換するPythonツールです。e-Gov法令APIからの直接取得、またはローカルのXMLファイルからの変換に対応しています。

> 📌 **このプロジェクトについて**
> 
> このツールは **ペアプログラミングによるAI生成ソフトウェア** です。
> ユーザーとAI（GitHub Copilot）が協力して開発・改善を行っています。
> 詳細は[プロジェクト情報](#プロジェクト情報)セクションを参照してください。

## 目次

- [プロジェクト情報](#プロジェクト情報)
- [特徴](#特徴)
- [必要要件](#必要要件)
- [インストール](#インストール)
- [使用方法](#使用方法)
  - [対話モード](#対話モード)
  - [コマンドライン引数モード](#コマンドライン引数モード)
- [出力フォーマット](#出力フォーマット)
- [設定ファイル](#設定ファイル)
- [トラブルシューティング](#トラブルシューティング)

---

## プロジェクト情報

### 開発方法

このプロジェクトは **ペアプログラミング** で開発されています：

- **プログラマー**: ユーザー（要件定義、設計、テスト）
- **AI アシスタント**: GitHub Copilot（実装、バグ修正、最適化）

### 開発工程

各機能の実装・改善では以下のプロセスで行われます：

1. **要件定義**: ユーザーが改善・追加要件を提示
2. **実装**: AI が複数の案を提案し、ユーザーが最適な実装を選択
3. **テスト**: ユーザーが動作確認し、問題があれば修正
4. **提出**: `git commit` で変更を記録（コミットメッセージに実装内容を記載）

### 実装例

#### HTMLテーブル処理の改善（2026-02-01）

**要件**: rowspan が `<thead>` から `<tbody>` に跨がるのはセマンティック的に不適切

**実装内容**:
- `render_table()` 関数を大幅に書き換え
- TableHeaderRow がある場合のみ `<thead>` を使用
- すべての TableRow を `<tbody>` のみで処理
- `header_occupancy` マップを削除し、処理を簡素化

**結果**: セマンティックHTML準拠のテーブル生成が実現

### XML要素対応率

**カバー率: 約 98%**（117要素中115要素に対応）

詳細は [XML要素対応状況.md](XML要素対応状況.md) を参照してください。

---

## 特徴

✅ **e-Gov法令APIからの直接取得**

- 法令名を入力するだけで最新の法令データを自動取得・変換
- 過去の時点（asof指定）にも対応

✅ **多様な入力形式**

- APIから直接取得
- ローカルのXMLファイルから変換
- フォルダ内の複数XMLファイルを一括変換
- リストファイルによる一括処理

✅ **読みやすいMarkdown出力**

- 階層構造を見出しレベルで表現
- 表（テーブル）はHTMLテーブルで再現
- ルビ（ふりがな）をHTMLタグで表現
- 法令の構造（編・章・節・条・項・号）を明確に表現

✅ **CSSスタイル同梱**

- ダークモード対応のスタイルシート付属
- 視覚的に区別しやすい色分け

---

## 必要要件

- **Python**: 3.7以上
- **必須ライブラリ**: `requests`

---

## インストール

### 1. リポジトリのクローンまたはダウンロード

```bash
git clone <リポジトリURL>
cd xml-markdown
```

### 2. 必要なPythonライブラリのインストール

```bash
python -m pip install requests
```

---

## 使用方法

このツールには2つの使用モードがあります：

### 対話モード

引数なしでスクリプトを実行すると、対話形式で操作できます。

```bash
python xml-to-md.py
```

#### モード1: 法令名を入力して検索（APIを使用）

1. プロンプトから「1」を選択
2. 法令名を入力（例: `道路交通法`）
3. 適用時点を指定（省略可、最新版を取得）
4. `output_Markdown/` フォルダに変換されたMarkdownファイルが保存されます

**例:**

```
選択してください (1/2/3/0): 1
法令名を入力してください: 道路交通法
適用時点 (asof) を指定してください。
（例: 2026-01-31 / 空Enterで最新版を取得）: 2025-06-01
```

#### モード2: XMLファイルのパス、またはフォルダを指定（ローカル）

1. プロンプトから「2」を選択
2. XMLファイルのパス、またはXMLファイルが入ったフォルダパスを入力
3. フォルダを指定した場合、内部のすべての `.xml` ファイルを一括変換

**例:**

```
選択してください (1/2/3/0): 2
XMLファイルのパス、またはフォルダパス: 道路交通法.xml
```

#### モード3: 法令リスト(law_list.txt)から一括処理

1. プロンプトから「3」を選択
2. リストファイル名を入力（デフォルト: `law_list.txt`）
3. 適用時点を指定（省略可）
4. リストに記載された全法令を自動で取得・変換

**例:**

```
選択してください (1/2/3/0): 3
リストファイル名を入力 (Enterで 'law_list.txt'): [Enter]
適用時点 (asof) を指定してください。
（例: 2026-01-31 / 空Enterで最新版を取得）: [Enter]
```

---

### コマンドライン引数モード

バッチ処理や自動化に便利なコマンドライン引数モードです。

#### 1. 単一法令の取得・変換

```bash
python xml-to-md.py --law 法令名 [--asof YYYY-MM-DD]
```

**例:**

```bash
# 最新版の道路交通法を取得
python xml-to-md.py --law 道路交通法

# 2025年6月1日時点の道路交通法を取得
python xml-to-md.py --law 道路交通法 --asof 2025-06-01
```

#### 2. リストファイルからの一括処理

```bash
python xml-to-md.py --list [リストファイル名] [--asof YYYY-MM-DD]
```

**例:**

```bash
# law_list.txtから一括処理（最新版）
python xml-to-md.py --list

# 指定したリストファイルから一括処理
python xml-to-md.py --list my_laws.txt

# 2025年1月1日時点で一括処理
python xml-to-md.py --list --asof 2025-01-01
```

#### 3. ヘルプの表示

```bash
python xml-to-md.py --help
```

**出力例:**

```
usage: xml-to-md.py [-h] [--law LAW] [--list [LIST]] [--asof ASOF]

Japanese Law XML to Markdown Converter

options:
  -h, --help     show this help message and exit
  --law LAW      法令名を指定してAPIから取得・変換します (確認なしで上書き)
  --list [LIST]  法令リストファイルを指定して一括処理します (デフォルト: law_list.txt)
  --asof ASOF    --law または --list 使用時に適用する法令の時点(YYYY-MM-DD)
```

---

## 出力フォーマット

### ファイル名

変換されたMarkdownファイルは `output_Markdown/` フォルダに以下の形式で保存されます：

```
法令名_施行日.md
```

**例:**

- `道路交通法_20250601.md`
- `日本国憲法_19470503.md`

### Markdown構造

#### 見出しレベル

法令の階層構造は以下のように変換されます：

- **H1 (`#`)**: 法令名
- **H2 (`##`)**: 編（Part）
- **H3 (`###`)**: 章（Chapter）
- **H4 (`####`)**: 節（Section）
- **H5 (`#####`)**: 款（Subsection）・目（Division）
- **H6 (`######`)**: 条（Article）

#### 箇条書き

- **項（Paragraph）**: `- **第1項**`
- **号（Item）**: `  - **第1号**`
- **号の細分**: インデントを深くして表現

#### テーブル（表）

表項目はHTMLの `<table>` タグで再現されます：

```html
<table class="writing-mode-vertical">
  <thead>
    <tr>
      <th>欄名1</th>
      <th>欄名2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>データ1</td>
      <td>データ2</td>
    </tr>
  </tbody>
</table>
```

**対応する属性:**

- `rowspan`、`colspan`: セルの結合
- `BorderTop`、`BorderBottom`、`BorderLeft`、`BorderRight`: 枠線スタイル
- `Align`: 水平方向の配置
- `Valign`: 垂直方向の配置
- `WritingMode`: 縦書き/横書き

#### ルビ（ふりがな）

```html
<ruby>漢字<rt>かんじ</rt></ruby>
```

#### 前文・附則

特別な構造要素として処理されます。

---

## 設定ファイル

### law_list.txt

一括処理用の法令リストファイルです。1行に1つの法令名を記載します。

**書式:**

```
# コメント行（無視されます）
; コメント行（無視されます）
法令名1
法令名2
法令名3
```

**例:**

```
# 基本六法
日本国憲法
刑法
民法
民事訴訟法
刑事訴訟法
商法

# 交通関連
道路交通法
道路交通法施行令
道路交通法施行規則
```

### style.css

Markdown表示用のCSSスタイルシートです。Markdownビューアや静的サイトジェネレータで使用できます。

**特徴:**

- ダークモード対応
- 階層ごとに色分けされた見出し
- HTMLテーブルのスタイル
- ルビ表示のサポート

**使用例（VSCode、Typoraなど）:**

MarkdownプレビューでCSSを読み込むように設定してください。

---

## トラブルシューティング

### Q: `ModuleNotFoundError: No module named 'requests'`

**A:** 必要なライブラリがインストールされていません。

```bash
python -m pip install requests
```

### Q: 法令が見つからない

**A:** 以下を確認してください：

- 法令名が正確か（正式名称を使用）
- ネットワーク接続が正常か
- e-Gov法令APIが稼働しているか

### Q: 出力ファイルが見つからない

**A:** `output_Markdown/` フォルダを確認してください。フォルダは自動的に作成されます。

### Q: XMLファイルの解析に失敗する

**A:** 以下を確認してください：

- XMLファイルが破損していないか
- e-Gov法令XML形式に準拠しているか（`XMLSchemaForJapaneseLaw_v3.xsd` 参照）

### Q: 表が正しく表示されない

**A:** HTMLテーブルに対応したMarkdownビューアを使用してください。または、`style.css` を読み込んで表示してください。

### Q: 過去の時点の法令が取得できない

**A:** `--asof` オプションで日付を指定してください。ただし、e-Gov APIで提供されている範囲内の日付である必要があります。

---

## ライセンス

このツールはオープンソースです。e-Gov法令APIの利用規約に従ってご使用ください。

### 開発記録

このプロジェクトの実装・改善履歴は `git commit` メッセージで詳細に記録されています。

```bash
# 開発履歴を確認
git log --oneline
```

主な commit 例：
- `fix(table): <thead>のrowspanをセマンティックHTML対応に修正`
- `build: 公開用ファイル整理`
- `docs: XML要素対応状況を2026-02-01版に更新`

---

## 参考リンク

- [e-Gov法令API](https://elaws.e-gov.go.jp/)
- [e-Gov法令XMLスキーマ](https://elaws.e-gov.go.jp/file/XMLSchemaForJapaneseLaw_v3.xsd)

---

## 更新履歴

### 2026-02-01

- **セマンティックHTML対応**: TableRow を `<tbody>` のみで処理
- **ファイル整理**: 公開用にテスト・デバッグファイルを削除
- **ドキュメント更新**: XML要素対応状況を98%に更新
- **README更新**: ペアプログラミングAI開発であることを明記

### 2026-01-31

- HTMLテーブル形式のサポート追加
- テーブル属性（rowspan、colspan、border、align、valignなど）の対応
- ルビのHTML形式出力に変更
- CSSスタイルの改善（ダークモード対応）

---

**Enjoy converting Japanese laws to Markdown! 📜→📝**
