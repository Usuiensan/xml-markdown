# 日本法令XML→Markdown変換ツール

日本の法令XMLデータを読みやすいMarkdown形式に変換するPythonツールです。e-Gov法令APIからの直接取得、またはローカルのXMLファイルからの変換に対応しています。

> 📌 **このプロジェクトについて**
>
> このツールは **AI生成によって作成されたソフトウェア** です。
> その点ご承知おき下さい。

## すぐ使いたい人はxml_to_md.exeもご利用可能です。

## 目次

- [特徴](#特徴)
- [必要要件](#必要要件)
- [インストール](#インストール)
- [使用方法](#使用方法)
  - [対話モード](#対話モード)
  - [コマンドライン引数モード](#コマンドライン引数モード)
- [出力フォーマット](#出力フォーマット)
  - [テーブル（表）のサポート](#テーブル表のサポート)
- [設定ファイル](#設定ファイル)
- [トラブルシューティング](#トラブルシューティング)

---

## 特徴

✅ **e-Gov法令APIからの直接取得**

- 法令名を入力するだけで最新の法令データを自動取得・変換
- 過去の時点（asof指定）にも対応

✅ **多様な入力形式**

- APIから直接取得
- ローカルのXMLファイルから変換
- フォルダ内の複数XMLファイルを一括変換
- リストファイルによる一括処理

✅ **柔軟な出力**

- 階層構造を見出しレベルで表現
- 表（テーブル）はHTMLテーブルで再現
- ルビ（ふりがな）をHTMLタグで表現
- 画像のダウンロードまたは直リンクを選択可能
- 漢数字から算用数字への変換（オプション）

✅ **CSSスタイル同梱**

- ダークモード対応のスタイルシート付属
- 視覚的に区別しやすい色分け

---

## 必要要件

- **Python**: 3.7以上
- **必須ライブラリ**: `requests`

---

## インストール

### 1. リポジトリのクローンまたはダウンロード

```bash
git clone <リポジトリURL>
cd xml-markdown
```

### 2. 必要なPythonライブラリのインストール

```bash
python -m pip install requests
```

---

## 使用方法

このツールには2つの使用モードがあります：

### 対話モード

引数なしでスクリプトを実行すると、対話形式で操作できます。

```bash
python xml_to_md.py
```

#### モード1: 法令名を入力して検索（APIを使用）

1. プロンプトから「1」を選択
2. 法令名を入力（例: `道路交通法`）
3. 適用時点を指定（省略可、最新版を取得）
4. `output_Markdown/` フォルダに変換されたMarkdownファイルが保存されます

**モード1の特徴:**

- e-Gov法令APIから法令データを直接取得
- Markdownファイル内に含まれる画像を自動的にダウンロード＆埋め込み
- ファイル名に施行日が自動的に付与される（例: `道路交通法_20250601.md`）

---

#### モード2: XMLファイルのパス、またはフォルダを指定（ローカル）

1. プロンプトから「2」を選択
2. XMLファイルのパス、またはXMLファイルが入ったフォルダパスを入力
3. フォルダを指定した場合、内部のすべての `.xml` ファイルを一括変換

**⚠️ モード2の注意事項:**

- ファイル名に施行日が付与されないことがあります。(e-govから手動ダウンロードしたxmlファイルには施行日情報が含まれていないことがあります。)
- **画像は埋め込まれません**: 画像データはダウンロードされず、Markdownに含まれません
  - **理由**: ローカルXMLファイルには法令履歴IDが含まれていないため、画像APIを呼び出せません
  - **対策**: 画像が必要な場合は、モード1（API取得）を使用してください

---

#### モード3: 法令リスト(law_list.txt)から一括処理

1. プロンプトから「3」を選択
2. リストファイル名を入力（デフォルト: `law_list.txt`）
3. 適用時点を指定（省略可）
4. リストに記載された全法令を自動で取得・変換

**モード3の特徴:**

- 複数の法令を一度に処理可能
- リストファイルに含まれるすべての法令を**確認なしで自動上書き**
- バッチ処理や自動化に最適
- 画像も自動的にダウンロード＆埋め込み可能
- ⚠️ **既存ファイルは自動上書きされます**（確認なし）

---

### コマンドライン引数モード

バッチ処理や自動化に便利なコマンドライン引数モードです。

#### 1. 単一法令の取得・変換

```bash
python xml_to_md.py --law 法令名 [--asof YYYY-MM-DD]
```

**例:**

```bash
# 最新版の道路交通法を取得
python xml_to_md.py --law 道路交通法

# 2025年6月1日時点の道路交通法を取得
python xml_to_md.py --law 道路交通法 --asof 2025-06-01
```

#### 2. リストファイルからの一括処理

```bash
python xml_to_md.py --list [リストファイル名] [--asof YYYY-MM-DD]
```

**例:**

```bash
# law_list.txtから一括処理（最新版）
python xml_to_md.py --list

# 2025年1月1日時点で一括処理
python xml_to_md.py --list --asof 2025-01-01
```

**⚠️ 特徴**: 既存ファイルは**確認なしで自動上書き**されます（バッチ処理向け）

#### 3. その他のオプション

- `--convert-kanji`: 漢数字を算用数字に変換します。
- `--link-images`: 画像をダウンロードせず、e-Govへの直リンクを生成します。

#### 4. ヘルプの表示

```bash
python xml_to_md.py --help
```

**出力例:**

```
usage: xml_to_md.py [-h] [--law LAW] [--list [LIST]] [--asof ASOF]
                    [--download-images | --link-images] [--convert-kanji]

Japanese Law XML to Markdown Converter

options:
  -h, --help         show this help message and exit
  --law LAW          法令名を指定してAPIから取得・変換します (確認なしで上書き)
  --list [LIST]      法令リストファイルを指定して一括処理します (デフォルト: law_list.txt)
  --asof ASOF        --law または --list 使用時に適用する法令の時点(YYYY-MM-DD)
  --download-images  画像をダウンロードして埋め込む（デフォルト）
  --link-images      画像をダウンロードせず、e-Gov直リンクのみ提供
  --convert-kanji    漢数字を算用数字に変換する
```

---

## 出力フォーマット

### ファイル名

変換されたMarkdownファイルは `output_Markdown/` フォルダに以下の形式で保存されます：
`法令名_施行日.md` (例: `道路交通法_20250601.md`)

### Markdown構造

- **見出し**: 法令の階層（編・章・節・条など）を見出しレベルで表現します。
- **箇条書き**: 項・号などをリストで表現します。
- **ルビ**: `<ruby>漢字<rt>かんじ</rt></ruby>` のHTMLタグでふりがなを表現します。

### テーブル（表）のサポート

表はHTMLの `<table>` タグで再現されます。`rowspan`, `colspan` などのセル結合や、`Align`（水平位置）, `Valign`（垂直位置）などの属性に対応しています。

#### テーブルの罫線（Border）について

法令XMLの表は、しばしば `rowspan` などの論理的な構造ではなく、**罫線の有無（`Border`属性）**でセルの結合が表現されます。このツールは、`Border`属性をCSSの `border-style` に変換することで、見た目を維持します。

```html
<!-- XMLで <TableColumn BorderBottom="none"> となっている場合 -->
<td style="border-bottom-style: none;">内容</td>
```

#### 罫線情報の最適化（トークン削減）

出力するMarkdownのトークン数を削減するため、テーブルの罫線がすべて単純な実線（solid）の場合、罫線情報を定義する`style`属性をHTMLから削除する最適化を行っています。

- **単純な表**: `style`属性がなくなるため、ファイルサイズが削減され、AIなどが解釈しやすくなります。
- **複雑な表（点線などを含む）**: `style`属性を保持することで、視覚的な構造を維持します。

---

## 設定ファイル

### law_list.txt

一括処理用の法令リストファイルです。1行に1つの法令名を記載します。コメント行は `#` または `;` で始めることができます。

### style.css

Markdown表示用のCSSスタイルシートです。ダークモードに対応しており、見出しやテーブルを読みやすくスタイリングします。

---

## トラブルシューティング

### Q: `ModuleNotFoundError: No module named 'requests'`

**A:** 必要なライブラリがインストールされていません。`python -m pip install requests` を実行してください。

### Q: 法令が見つからない / 変換に失敗する

**A:** 法令名が正確か、ネットワーク接続が正常か、XMLファイルが破損していないかなどを確認してください。

### Q: 表が正しく表示されない

**A:** HTMLテーブルに対応したMarkdownビューア（VSCodeのプレビューなど）を使用し、`style.css` を読み込むように設定してください。

### Q: 表の罫線がAIに正確に読み取られない

**A:** これは、法令XMLの表が罫線（見た目）で構造を表現していることに起因する既知の課題です。AIに表を解釈させる際は、元のXML構造を参考にさせたり、「表の構造は罫線で表現されている」という前提を与えたりすると、精度が向上することがあります。

---

## 開発情報

このプロジェクトはAI（GitHub Copilot, Gemini）とのペアプログラミングで開発されています。実装・改善履歴は `git commit` メッセージで記録されています。

- **XML要素対応率**: 約 98%（詳細は [XML要素対応状況.md](XML要素対応状況.md) を参照）
- **ライセンス**: オープンソース（e-Gov法令APIの利用規約に従ってください）
- **参考リンク**: [e-Gov法令API](https://elaws.e-gov.go.jp/)
